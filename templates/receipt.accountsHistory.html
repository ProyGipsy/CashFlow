{% extends "receipt.sellerBase.html" %}

{% block title %}Gipsy - Historial de Cuentas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='CSS/accountsHistory.css') }}"/>
{% endblock %}

{% block content %}
<div class="content">
    <div class="title-container">
        <a class="back" href="{{ url_for('homeSeller') }}"><img src="{{ url_for('static', filename='IMG/back.png') }}" alt="Back"></a>
        <div class="title-center">
            <h2>Historial de Cuentas</h2>
        </div>
    </div>

    <div class="filter-row-container">
        <form action="#" method="GET" class="history-filters">
            <div class="filter-group">
                <label for="year">Año:</label>
                <select id="year" name="year">
                    <option value="ALL">Todos</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="month">Mes:</label>
                <select id="month" name="month">
                    <option value="ALL">Todos</option>
                    <option value="01">Enero</option>
                    <option value="02">Febrero</option>
                    <option value="03">Marzo</option>
                    </select>
            </div>
            <div class="filter-group">
                <label for="store">Tienda:</label>
                <select id="store" name="store">
                    <option value="ALL">Todas</option>
                    <option value="S01">Sucursal Principal</option>
                    <option value="S02">Sucursal Norte</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="customer">Cliente:</label>
                <select id="customer" name="customer">
                    <option value="ALL">Todos</option>
                    <option value="C01">Distribuidora Global C.A.</option>
                    <option value="C02">Inversiones Maracay</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="currency">Moneda:</label>
                <select id="currency" name="currency">
                    <option value="ALL">Todas</option>
                    <option value="USD">Bs</option>
                    <option value="VEF">USD</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="docType">Tipo Doc:</label>
                <select id="docType" name="docType">
                    <option value="ALL">Todos</option>
                    <option value="FAC">FAC</option>
                    <option value="NC">N/C</option>
                    <option value="ND">N/D</option>
                    <option value="NE">N/E</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="status">Estatus:</label>
                <select id="status" name="status">
                    <option value="ALL">Todos</option>
                    <option value="PAID">Pagado</option>
                    <option value="PARTIAL">Abonado</option>
                    <option value="PENDING">Pendiente</option>
                </select>
            </div>
            <button type="submit" class="btn-filter">Filtrar</button>
        </form>
    </div>

    <div class="table-container">
        <table class="styled-table">
            <thead>
                <tr>
                    <th>N_CTA</th>
                    <th>Tipo</th>
                    <th>Tienda</th>
                    <th>Cliente</th>
                    <th>Monto Total</th>
                    <th>Monto Abonado</th>
                    <th>Recibos</th>
                    <th>Status Pago</th>
                    <th>F. Cierre de Ciclo</th>
                    <th>Pago de Comisión</th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts_history %}
                <tr>
                    <td>{{ account[1] }}</td>
                    <td>{{ account[2] }}</td>
                    <td>{{ account[3] }}</td>
                    <td>{{ account[4] }}</td>
                    <td>{{ account[5] }} {{account[6] }}</td>
                    <td>{{ account[5] }} {{ account[7] }}</td>
                    <td>{{ account[8] }}</td>
                    <td>
                        {% set status_class = '' %}
                        {% if account[9] in ['Pagada', 'Usada'] %}
                            {% set status_class = 'paid' %}
                        {% elif account[9] in ['Abonada', 'Parcialmente Usada'] %}
                            {% set status_class = 'partial' %}
                        {% elif account[9] in ['Pendiente', 'Disponible'] %}
                            {% set status_class = 'pending' %}
                        {% endif %}
                        <span class="status-badge {{ status_class }}">
                            {{ account[9] }}
                        </span>
                    </td>                  
                    <td>{{ account[10] or ' -- ' }}</td>
                    <td>{{ account[11] or ' -- ' }}</td>
                </tr>
                {% endfor %}                
            </tbody>
        </table>
    </div>

    <div class="pagination">
        {% if current_page > 1 %}
            <a href="{{ url_for('accountsHistory', page=current_page-1) }}">Anterior</a>
        {% endif %}

        {% for p in range(1, total_pages + 1) %}
            {% if p == current_page %}
                <span class="active a" style="padding: 8px 12px; background: #324bab; color: white; border-radius: 4px;">{{ p }}</span>
            {% else %}
                <a href="{{ url_for('accountsHistory', page=p) }}">{{ p }}</a>
            {% endif %}
        {% endfor %}

        {% if current_page < total_pages %}
            <a href="{{ url_for('accountsHistory', page=current_page+1) }}">Siguiente</a>
        {% endif %}
    </div>
</div>
{% endblock %}